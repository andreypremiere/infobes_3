{"ast":null,"code":"import jwt from 'jsonwebtoken';\nexport function saveTokenWithExpToCookie(token) {\n  try {\n    // Раскодируем JWT без проверки\n    const base64Payload = token.split('.')[1];\n    const payload = JSON.parse(atob(base64Payload)); // Декодирование Base64\n\n    // Извлекаем `exp` из payload\n    const expTimeInSeconds = payload.exp;\n    const currentTimeInSeconds = Math.floor(Date.now() / 1000);\n    const maxAge = expTimeInSeconds - currentTimeInSeconds;\n    const jwtDecoded = decodeToken(token);\n    console.log('Токен распарсенный decodeToken:', jwtDecoded);\n    if (maxAge > 0) {\n      // Сохраняем токен в cookie с рассчитанным временем жизни\n      document.cookie = `jwt=${token}; path=/; Secure; SameSite=Strict; max-age=${maxAge}`;\n    } else {\n      console.error(\"Срок действия токена истек, невозможно сохранить в cookie.\");\n    }\n  } catch (error) {\n    console.error(\"Ошибка при обработке JWT токена:\", error);\n  }\n}\nexport function getTokenFromCookie() {\n  const cookies = document.cookie.split('; ');\n  const jwtCookie = cookies.find(row => row.startsWith('jwt='));\n  return jwtCookie ? jwtCookie.split('=')[1] : null;\n}\nexport function decodeToken(token) {\n  try {\n    const decoded = jwt.decode(token);\n    return decoded;\n  } catch (err) {\n    console.error('Ошибка при декодировании токена:', err);\n    return null;\n  }\n}","map":{"version":3,"names":["jwt","saveTokenWithExpToCookie","token","base64Payload","split","payload","JSON","parse","atob","expTimeInSeconds","exp","currentTimeInSeconds","Math","floor","Date","now","maxAge","jwtDecoded","decodeToken","console","log","document","cookie","error","getTokenFromCookie","cookies","jwtCookie","find","row","startsWith","decoded","decode","err"],"sources":["D:/учеба/3 курс/1 семестр/ИнфоБез/pracitce_3/practice_3_ui/src/JWTProvider.js"],"sourcesContent":["import jwt from 'jsonwebtoken'\r\n\r\n\r\nexport function saveTokenWithExpToCookie(token) {\r\n    try {\r\n        // Раскодируем JWT без проверки\r\n        const base64Payload = token.split('.')[1];\r\n        const payload = JSON.parse(atob(base64Payload)); // Декодирование Base64\r\n\r\n        // Извлекаем `exp` из payload\r\n        const expTimeInSeconds = payload.exp;\r\n        const currentTimeInSeconds = Math.floor(Date.now() / 1000);\r\n        const maxAge = expTimeInSeconds - currentTimeInSeconds;\r\n\r\n        const jwtDecoded = decodeToken(token)\r\n        console.log('Токен распарсенный decodeToken:', jwtDecoded)\r\n\r\n        if (maxAge > 0) {\r\n            // Сохраняем токен в cookie с рассчитанным временем жизни\r\n            document.cookie = `jwt=${token}; path=/; Secure; SameSite=Strict; max-age=${maxAge}`;\r\n        } else {\r\n            console.error(\"Срок действия токена истек, невозможно сохранить в cookie.\");\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Ошибка при обработке JWT токена:\", error);\r\n    }\r\n}\r\n\r\nexport function getTokenFromCookie() {\r\n    const cookies = document.cookie.split('; ');\r\n    const jwtCookie = cookies.find(row => row.startsWith('jwt='));\r\n    return jwtCookie ? jwtCookie.split('=')[1] : null;\r\n}\r\n\r\nexport function decodeToken(token) {\r\n    try {\r\n        const decoded = jwt.decode(token);\r\n        return decoded;\r\n    } catch (err) {\r\n        console.error('Ошибка при декодировании токена:', err);\r\n        return null;\r\n    }\r\n}"],"mappings":"AAAA,OAAOA,GAAG,MAAM,cAAc;AAG9B,OAAO,SAASC,wBAAwBA,CAACC,KAAK,EAAE;EAC5C,IAAI;IACA;IACA,MAAMC,aAAa,GAAGD,KAAK,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACzC,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACL,aAAa,CAAC,CAAC,CAAC,CAAC;;IAEjD;IACA,MAAMM,gBAAgB,GAAGJ,OAAO,CAACK,GAAG;IACpC,MAAMC,oBAAoB,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;IAC1D,MAAMC,MAAM,GAAGP,gBAAgB,GAAGE,oBAAoB;IAEtD,MAAMM,UAAU,GAAGC,WAAW,CAAChB,KAAK,CAAC;IACrCiB,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAEH,UAAU,CAAC;IAE1D,IAAID,MAAM,GAAG,CAAC,EAAE;MACZ;MACAK,QAAQ,CAACC,MAAM,GAAG,OAAOpB,KAAK,8CAA8Cc,MAAM,EAAE;IACxF,CAAC,MAAM;MACHG,OAAO,CAACI,KAAK,CAAC,4DAA4D,CAAC;IAC/E;EACJ,CAAC,CAAC,OAAOA,KAAK,EAAE;IACZJ,OAAO,CAACI,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;EAC5D;AACJ;AAEA,OAAO,SAASC,kBAAkBA,CAAA,EAAG;EACjC,MAAMC,OAAO,GAAGJ,QAAQ,CAACC,MAAM,CAAClB,KAAK,CAAC,IAAI,CAAC;EAC3C,MAAMsB,SAAS,GAAGD,OAAO,CAACE,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,UAAU,CAAC,MAAM,CAAC,CAAC;EAC7D,OAAOH,SAAS,GAAGA,SAAS,CAACtB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI;AACrD;AAEA,OAAO,SAASc,WAAWA,CAAChB,KAAK,EAAE;EAC/B,IAAI;IACA,MAAM4B,OAAO,GAAG9B,GAAG,CAAC+B,MAAM,CAAC7B,KAAK,CAAC;IACjC,OAAO4B,OAAO;EAClB,CAAC,CAAC,OAAOE,GAAG,EAAE;IACVb,OAAO,CAACI,KAAK,CAAC,kCAAkC,EAAES,GAAG,CAAC;IACtD,OAAO,IAAI;EACf;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}